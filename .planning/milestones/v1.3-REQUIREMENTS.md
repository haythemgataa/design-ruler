# Requirements Archive: v1.3 Code Unification

**Archived:** 2026-02-17
**Status:** SHIPPED

For current requirements, see `.planning/REQUIREMENTS.md`.

---

# Requirements: Design Ruler

**Defined:** 2026-02-16
**Core Value:** Instant, accurate pixel inspection of anything on screen — zero friction from Raycast invoke to dimension readout.

## v1.3 Requirements

Requirements for Code Unification milestone. Each maps to roadmap phases.

### Rendering

- [ ] **REND-01**: Shared font factory (`makeDesignFont(size:)`) replaces 3 identical OpenType feature setups in CrosshairView, GuideLine, SelectionOverlay
- [ ] **REND-02**: Shared `squirclePath(rect:radius:)` and `sectionPath(rect:leftRadius:rightRadius:)` replace 3 duplicated path implementations
- [ ] **REND-03**: Shared `labelText(_:)` and `valueText(_:)` replace identical implementations in CrosshairView and GuideLine
- [ ] **REND-04**: Shared pill shadow configuration replaces 3 identical shadow setups
- [ ] **REND-05**: Shared text layer factory replaces duplicated CATextLayer boilerplate in CrosshairView and GuideLine

### Tokens

- [ ] **TOKN-01**: Centralized design tokens file defines shared colors (pill bg, hover red, shadow), radii, heights, and kerning values
- [ ] **TOKN-02**: Standardized animation durations (2-3 tiers) replace scattered magic numbers across 5+ files
- [ ] **TOKN-03**: Shared `"differenceBlendMode"` string constant replaces inline literals

### Transactions

- [ ] **TXNS-01**: `CATransaction.instant { }` helper eliminates 25+ disable-actions boilerplate blocks
- [ ] **TXNS-02**: `CATransaction.animated(duration:) { }` helper eliminates 12+ animated transaction blocks

### Coordinator

- [ ] **CORD-01**: Shared coordinator base extracts warmup capture, permission check, cursor screen detection from Ruler.swift and AlignmentGuides.swift
- [ ] **CORD-02**: Shared coordinator base extracts window lifecycle (cleanup, show loop, key window setup)
- [ ] **CORD-03**: Shared coordinator base extracts `handleExit()`, `handleFirstMove()`, `setupSignalHandler()`, `resetInactivityTimer()`
- [ ] **CORD-04**: Shared screen capture utility replaces duplicate `captureScreen()` in EdgeDetector and AlignmentGuides
- [ ] **CORD-05**: CoordinateConverter extended with `appKitRectToCG(_:)` and `cgRectToAppKit(_:)` replacing 3 inline rect conversions

### Window

- [ ] **WIND-01**: Overlay window base extracts shared NSWindow configuration (10 properties) from RulerWindow and AlignmentGuidesWindow
- [ ] **WIND-02**: Overlay window base extracts `setupTrackingArea()`, `collapseHintBar()`, `mouseEntered`, `canBecomeKey`/`canBecomeMain`
- [ ] **WIND-03**: Overlay window base extracts mouse move throttle pattern (0.014s guard) and first-move detection
- [ ] **WIND-04**: Shared hint bar instantiation helper parameterized by mode

### Cursor

- [ ] **CURS-01**: CursorManager extended with resize cursor states (resizeUpDown, resizeLeftRight) replacing parallel cursor system in AlignmentGuidesWindow

### Cleanup

- [ ] **CLNP-01**: HintBarContent internal deduplication — shared `escTint`, `text()`, `exitText()` helpers extracted from 3 structs

## Future Requirements

None — this is a focused refactoring milestone.

## Out of Scope

| Feature | Reason |
|---------|--------|
| New user-facing features | This milestone is refactoring only |
| Rewriting edge detection | EdgeDetector is Ruler-specific, no duplication to fix |
| Rewriting HintBarView/HintBarContent architecture | Already well-factored, only minor internal cleanup needed |
| Changing the two-command structure | Commands stay separate; shared base extracts common code without merging them |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| REND-01 | Phase 13 | Pending |
| REND-02 | Phase 13 | Pending |
| REND-03 | Phase 13 | Pending |
| REND-04 | Phase 13 | Pending |
| REND-05 | Phase 13 | Pending |
| TOKN-01 | Phase 12 | Pending |
| TOKN-02 | Phase 12 | Pending |
| TOKN-03 | Phase 12 | Pending |
| TXNS-01 | Phase 12 | Pending |
| TXNS-02 | Phase 12 | Pending |
| CORD-01 | Phase 14 | Pending |
| CORD-02 | Phase 14 | Pending |
| CORD-03 | Phase 14 | Pending |
| CORD-04 | Phase 14 | Pending |
| CORD-05 | Phase 14 | Pending |
| WIND-01 | Phase 15 | Pending |
| WIND-02 | Phase 15 | Pending |
| WIND-03 | Phase 15 | Pending |
| WIND-04 | Phase 15 | Pending |
| CURS-01 | Phase 15 | Pending |
| CLNP-01 | Phase 16 | Pending |

**Coverage:**
- v1.3 requirements: 21 total
- Mapped to phases: 21
- Unmapped: 0

---
*Requirements defined: 2026-02-16*
*Last updated: 2026-02-16 after roadmap creation*
