---
phase: 23-distribution
plan: 01
subsystem: infra
tags: [code-signing, hardened-runtime, notarization, sparkle, xcodegen]

# Dependency graph
requires:
  - phase: 18-build-system
    provides: "Xcode project with xcodegen, Debug ad-hoc signing"
  - phase: 21-settings-and-preferences
    provides: "Sparkle updater integration with placeholder keys and startingUpdater: false"
provides:
  - "Entitlements file for Hardened Runtime (empty dict)"
  - "ExportOptions.plist for Developer ID xcodebuild -exportArchive"
  - "Release signing config (Developer ID Application, Manual style)"
  - "ENABLE_HARDENED_RUNTIME: YES in base settings"
  - "Sparkle updater re-enabled (startingUpdater: true)"
affects: [23-02, 23-03]

# Tech tracking
tech-stack:
  added: []
  patterns: ["per-config signing (Debug=ad-hoc, Release=Developer ID)", "DEVELOPMENT_TEAM via build setting variable for CI"]

key-files:
  created:
    - "App/Sources/DesignRuler.entitlements"
    - "App/ExportOptions.plist"
  modified:
    - "App/project.yml"
    - "App/Sources/AppDelegate.swift"
    - "App/Design Ruler.xcodeproj/project.pbxproj"

key-decisions:
  - "Empty entitlements dict — CGWindowListCreateImage/CGEventTap governed by TCC, not entitlements"
  - "DEVELOPMENT_TEAM uses $(DEVELOPMENT_TEAM) build setting variable — CI passes via xcodebuild override"
  - "Re-enabled Sparkle updater (startingUpdater: true) — real EdDSA key expected before distribution"

patterns-established:
  - "Per-config signing: Debug uses ad-hoc (-), Release uses Developer ID Application with Manual style"

# Metrics
duration: 3min 59s
completed: 2026-02-19
---

# Phase 23 Plan 01: Signing and Notarization Config Summary

**Developer ID signing with Hardened Runtime, entitlements, ExportOptions.plist, and Sparkle re-enabled for auto-updates**

## Performance

- **Duration:** 3min 59s
- **Started:** 2026-02-19T17:09:52Z
- **Completed:** 2026-02-19T17:13:51Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments
- Created minimal entitlements file (empty dict, no Hardened Runtime exceptions needed)
- Created ExportOptions.plist for Developer ID xcodebuild -exportArchive
- Configured project.yml with per-config signing (Debug=ad-hoc, Release=Developer ID) and Hardened Runtime
- Re-enabled Sparkle updater (startingUpdater: true) for auto-update readiness
- Debug build still succeeds without Developer ID certificate

## Task Commits

Each task was committed atomically:

1. **Task 1: Create entitlements file and ExportOptions.plist** - `7cd7408` (feat)
2. **Task 2: Update project.yml for Release signing and re-enable Sparkle updater** - `2140cad` (feat)

## Files Created/Modified
- `App/Sources/DesignRuler.entitlements` - Minimal entitlements for Hardened Runtime (empty dict)
- `App/ExportOptions.plist` - Developer ID export method for xcodebuild -exportArchive
- `App/project.yml` - Release signing config, ENABLE_HARDENED_RUNTIME, CODE_SIGN_ENTITLEMENTS
- `App/Sources/AppDelegate.swift` - Sparkle updater startingUpdater changed from false to true
- `App/Design Ruler.xcodeproj/project.pbxproj` - Regenerated by xcodegen

## Decisions Made
- Empty entitlements dict: CGWindowListCreateImage and CGEventTap are governed by TCC (runtime Screen Recording permission), not by code-signing entitlements. No Hardened Runtime exceptions needed.
- DEVELOPMENT_TEAM uses $(DEVELOPMENT_TEAM) build setting variable so CI can pass the team ID via xcodebuild -DEVELOPMENT_TEAM override without hardcoding it.
- Re-enabled Sparkle updater now (startingUpdater: true) because real EdDSA key will be set by the user as part of Phase 23 setup, and the updater needs to start on launch.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Entitlements and export options ready for CI notarization pipeline (23-02)
- Sparkle updater re-enabled, awaiting real EdDSA key configuration
- Debug builds unaffected; Release builds require Developer ID certificate (CI responsibility)

---
*Phase: 23-distribution*
*Completed: 2026-02-19*
