---
phase: 17-unified-cursor-manager-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - swift/Ruler/Sources/Cursor/CursorManager.swift
  - swift/Ruler/Sources/Utilities/OverlayWindow.swift
autonomous: true

must_haves:
  truths:
    - "CursorManager class doc comment accurately describes the cursorUpdate(with:) mechanism, not mouseMoved"
    - "CursorManager has no dead code (reset method removed)"
    - "OverlayWindow tracking area comment explains why .cursorUpdate is included"
    - "Both commands build and run with identical behavior"
  artifacts:
    - path: "swift/Ruler/Sources/Cursor/CursorManager.swift"
      provides: "Accurate doc comments, no dead reset() method"
      contains: "cursorUpdate"
    - path: "swift/Ruler/Sources/Utilities/OverlayWindow.swift"
      provides: "Clear cursorUpdate explanation in tracking area comment"
      contains: "cursorUpdate"
  key_links:
    - from: "swift/Ruler/Sources/Utilities/OverlayWindow.swift"
      to: "CursorManager.shared.applyCursor()"
      via: "cursorUpdate(with:) override"
      pattern: "cursorUpdate.*applyCursor"
---

<objective>
Clean up CursorManager and OverlayWindow documentation and dead code after the v1.3 unification audit.

Purpose: The audit confirmed the cursor state machine is correct, but found inaccurate doc comments (referencing disableCursorRects and mouseMoved instead of cursorUpdate) and a dead reset() method that just delegates to restore(). This plan fixes documentation accuracy and removes dead code.

Output: CursorManager.swift with accurate class doc comment and no dead code; OverlayWindow.swift with clear cursorUpdate tracking area explanation.
</objective>

<execution_context>
@/Users/haythem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haythem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@swift/Ruler/Sources/Cursor/CursorManager.swift
@swift/Ruler/Sources/Utilities/OverlayWindow.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix CursorManager doc comment and remove dead reset() method</name>
  <files>swift/Ruler/Sources/Cursor/CursorManager.swift</files>
  <action>
1. Replace the class-level doc comment (lines 3-8) with an accurate description:
   - Remove reference to `disableCursorRects()` — this is NOT used in the codebase
   - Remove claim that `applyCursor()` runs on every `mouseMoved` — it actually runs from `cursorUpdate(with:)` in OverlayWindow
   - Accurately describe the mechanism: OverlayWindow's tracking area includes `.cursorUpdate`, and its `cursorUpdate(with:)` override calls `applyCursor()` — this is the standard pattern for borderless overlay windows to override system cursor behavior
   - Keep the state diagram showing Ruler vs Guides paths (lines 9-10), updating if wording needs adjustment

2. Remove the `reset()` method entirely (lines 140-142). It is identical to `restore()` and has zero external call sites — `restore()` is the only method called (from OverlayCoordinator.handleExit). No call sites to update.

3. Review all other method-level doc comments in the file for accuracy. The existing method comments are mostly correct per the audit, but verify:
   - `applyCursor()` comment on line 113-114 says "Called on every mouseMoved" — fix to say "Called from cursorUpdate(with:) in OverlayWindow"
  </action>
  <verify>
Run `swift build` from `swift/Ruler/` to confirm compilation. Grep for `reset()` in CursorManager.swift to confirm removal. Grep for `disableCursorRects` and `mouseMoved` in CursorManager.swift doc comments to confirm they are gone.
  </verify>
  <done>CursorManager.swift has accurate class and method doc comments describing the cursorUpdate mechanism, no reference to disableCursorRects or mouseMoved in doc comments, and the dead reset() method is removed.</done>
</task>

<task type="auto">
  <name>Task 2: Clarify OverlayWindow cursorUpdate tracking area comment</name>
  <files>swift/Ruler/Sources/Utilities/OverlayWindow.swift</files>
  <action>
1. Review the existing `cursorUpdate(with:)` override doc comment (lines 53-55). It already explains the mechanism well. Improve if needed:
   - Ensure it mentions that NOT calling `super` is intentional (prevents system from resetting cursor)
   - Ensure it connects to CursorManager's `applyCursor()` clearly

2. Review the tracking area setup comment. The `.cursorUpdate` option in the tracking area (line 47) is the key enabler — without it, `cursorUpdate(with:)` would never be called. Add a brief inline comment on that line if not already clear, explaining WHY `.cursorUpdate` is included alongside `.mouseEnteredAndExited` and `.activeAlways`.

3. Build to verify no regressions: `swift build` from `swift/Ruler/`.
  </action>
  <verify>
Run `swift build` from `swift/Ruler/` to confirm compilation succeeds with no warnings.
  </verify>
  <done>OverlayWindow.swift has clear documentation explaining why .cursorUpdate is in the tracking area options and how cursorUpdate(with:) overrides system cursor behavior by calling CursorManager.applyCursor().</done>
</task>

</tasks>

<verification>
1. `cd swift/Ruler && swift build` succeeds with no errors
2. No references to `disableCursorRects` in CursorManager doc comments
3. No claim that `applyCursor()` runs on `mouseMoved` in CursorManager doc comments
4. `reset()` method no longer exists in CursorManager.swift
5. `cursorUpdate` mechanism is accurately documented in both files
</verification>

<success_criteria>
- CursorManager class doc comment accurately describes the cursorUpdate(with:) override pattern
- CursorManager applyCursor() method comment references cursorUpdate, not mouseMoved
- Dead reset() method removed from CursorManager (zero call sites)
- OverlayWindow tracking area and cursorUpdate override have clear documentation
- Project builds successfully with no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/17-unified-cursor-manager-fixes/17-01-SUMMARY.md`
</output>
