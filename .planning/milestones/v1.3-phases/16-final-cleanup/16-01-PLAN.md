---
phase: 16-final-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - swift/Ruler/Sources/Rendering/HintBarContent.swift
autonomous: true

must_haves:
  truths:
    - "escTint color is defined exactly once and shared by HintBarContent, CollapsedRightContent, and HintBarGlassRoot"
    - "text() helper is defined exactly once and shared by HintBarContent and HintBarGlassRoot"
    - "exitText() helper is defined exactly once and shared by HintBarContent and HintBarGlassRoot"
    - "HintBarContent renders identically in both inspect and alignment guides modes"
  artifacts:
    - path: "swift/Ruler/Sources/Rendering/HintBarContent.swift"
      provides: "Deduplicated hint bar content with shared helpers"
      contains: "HintBarTextStyle"
  key_links:
    - from: "HintBarContent"
      to: "HintBarTextStyle"
      via: "escTint, text(), exitText() calls"
      pattern: "HintBarTextStyle"
    - from: "CollapsedRightContent"
      to: "HintBarTextStyle"
      via: "escTint call"
      pattern: "HintBarTextStyle"
    - from: "HintBarGlassRoot"
      to: "HintBarTextStyle"
      via: "escTint, text(), exitText() calls"
      pattern: "HintBarTextStyle"
---

<objective>
Deduplicate escTint, text(), and exitText() across the 3 HintBarContent structs so each is defined once and shared.

Purpose: Eliminate the last remaining copy-paste duplication in the codebase — the same escTint color (4-line computed property) and the same text/exitText helpers (each 5 lines) are duplicated across HintBarContent, CollapsedRightContent, and HintBarGlassRoot.

Output: Single HintBarContent.swift with shared helpers, zero behavioral change.
</objective>

<execution_context>
@/Users/haythem/.claude/get-shit-done/workflows/execute-plan.md
@/Users/haythem/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@swift/Ruler/Sources/Rendering/HintBarContent.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract shared text helpers and deduplicate escTint across all 3 structs</name>
  <files>swift/Ruler/Sources/Rendering/HintBarContent.swift</files>
  <action>
Create a file-private helper struct `HintBarTextStyle` at the top of HintBarContent.swift (after imports, before HintBarMode) that centralizes the duplicated logic:

```swift
/// Shared text styling for all hint bar content views.
private struct HintBarTextStyle {
    let isDark: Bool

    var escTint: Color {
        isDark
            ? Color(nsColor: NSColor(srgbRed: 0xFF / 255.0, green: 0xB2 / 255.0, blue: 0xB2 / 255.0, alpha: 1))
            : Color(nsColor: NSColor(srgbRed: 0x80 / 255.0, green: 0, blue: 0, alpha: 1))
    }

    var escTintFill: Color {
        Color(nsColor: NSColor(srgbRed: 1, green: 0, blue: 0, alpha: 0.1))
    }

    func text(_ string: String) -> Text {
        Text(string)
            .font(.system(size: 16, weight: .semibold))
            .tracking(-0.48)
            .foregroundColor(isDark ? .white : .black)
    }

    func exitText(_ string: String) -> Text {
        Text(string)
            .font(.system(size: 16, weight: .semibold))
            .tracking(-0.48)
            .foregroundColor(escTint)
    }
}
```

Note: `HintBarGlassRoot.text()` returns `some View` while `HintBarContent.text()` returns `Text`. The implementation returns `Text` which satisfies both (Text conforms to View). But `HintBarGlassRoot` uses `text()` in `.opacity(0)` chains, so make sure the return type works for both call sites. Since `Text` conforms to `View`, returning `Text` is sufficient.

Then refactor each of the 3 structs:

**HintBarContent:**
- Remove the private `isDark`, `escTint`, `text()`, and `exitText()` properties/methods
- Add a computed property: `private var style: HintBarTextStyle { HintBarTextStyle(isDark: !state.isOnLightBackground) }`
- Replace all `escTint` references with `style.escTint`
- Replace all `text("...")` calls with `style.text("...")`
- Replace all `exitText("...")` calls with `style.exitText("...")`
- Replace `Color(nsColor: NSColor(srgbRed: 1, green: 0, blue: 0, alpha: 0.1))` tintFill with `style.escTintFill`

**CollapsedRightContent:**
- Remove the private `isDark` and `escTint` properties
- Add a computed property: `private var style: HintBarTextStyle { HintBarTextStyle(isDark: !state.isOnLightBackground) }`
- Replace `escTint` with `style.escTint`
- Replace `Color(nsColor: NSColor(srgbRed: 1, green: 0, blue: 0, alpha: 0.1))` tintFill with `style.escTintFill`

**HintBarGlassRoot:**
- Remove the private `isDark`, `escTint`, `text()`, and `exitText()` properties/methods
- Add a computed property: `private var style: HintBarTextStyle { HintBarTextStyle(isDark: !state.isOnLightBackground) }`
- Replace all `escTint` references with `style.escTint`
- Replace all `text("...")` calls with `style.text("...")`
- Replace all `exitText("...")` calls with `style.exitText("...")`
- In the `escCap` computed var, replace the inline tintFill with `style.escTintFill`

IMPORTANT: The `text()` method in `HintBarGlassRoot` returns `some View` (not `Text`). The shared `HintBarTextStyle.text()` returns `Text`. Since `Text` conforms to `View`, this works everywhere. Verify that all `.opacity(0)` chains in the glass layer still compile.

IMPORTANT: Do NOT change any visual values (colors, font sizes, tracking, padding, frame heights). This is a pure extraction refactor with zero behavioral change.

After refactoring, verify:
- `escTint` appears only inside `HintBarTextStyle` (1 definition)
- `func text(` appears only inside `HintBarTextStyle` (1 definition)
- `func exitText(` appears only inside `HintBarTextStyle` (1 definition)
- `isDark` appears only inside `HintBarTextStyle` (1 definition) plus the 3 `style` computed properties that construct it
  </action>
  <verify>
Run `swift build` in the swift/Ruler directory to confirm compilation succeeds with zero errors.

Then verify deduplication:
- Search the file for `var escTint:` — should appear exactly once (in HintBarTextStyle)
- Search the file for `func text(` — should appear exactly once (in HintBarTextStyle)
- Search the file for `func exitText(` — should appear exactly once (in HintBarTextStyle)
- Search the file for `private var isDark:` — should appear exactly once (in HintBarTextStyle)
  </verify>
  <done>
escTint, text(), exitText(), and isDark are each defined exactly once in HintBarTextStyle. All 3 consumer structs (HintBarContent, CollapsedRightContent, HintBarGlassRoot) reference the shared helper via a `style` computed property. The project builds successfully with zero behavioral changes.
  </done>
</task>

</tasks>

<verification>
1. `swift build` succeeds in `swift/Ruler/` directory
2. `ray build` succeeds (if available) — clear `.raycast-swift-build` cache first if needed
3. `escTint` color definition count = 1
4. `text()` helper definition count = 1
5. `exitText()` helper definition count = 1
6. `isDark` private computed property definition count = 1
7. No inline `NSColor(srgbRed: 0xFF / 255.0, green: 0xB2` outside HintBarTextStyle
8. No inline `NSColor(srgbRed: 0x80 / 255.0, green: 0` outside HintBarTextStyle
</verification>

<success_criteria>
- escTint, text(), and exitText() are each defined exactly once and shared across all 3 structs
- HintBarContent.swift compiles without errors
- Zero visual/behavioral change to hint bar rendering in either command mode
</success_criteria>

<output>
After completion, create `.planning/phases/16-final-cleanup/16-01-SUMMARY.md`
</output>
