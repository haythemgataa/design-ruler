---
phase: 18-build-system
plan: 02
subsystem: infra
tags: [xcodegen, xcode, spm, local-package, lsuielement, universal-binary, macos-app]

# Dependency graph
requires:
  - phase: 18-01
    provides: DesignRulerCore library target (SPM package with public library product)
provides:
  - App/project.yml xcodegen spec defining standalone macOS app target
  - App/Sources/AppDelegate.swift minimal @main stub
  - App/Sources/Info.plist with LSUIElement=true (no Dock icon, no Cmd+Tab entry)
  - App/Design Ruler.xcodeproj generated Xcode project (committed for convenience)
  - Verified BUILD SUCCEEDED linking against DesignRulerCore local package
affects:
  - 19-app-target (adds menu bar, hotkey, overlay wiring to this app shell)
  - All subsequent phases building on standalone app

# Tech tracking
tech-stack:
  added:
    - xcodegen 2.44.1 (Xcode project generation from YAML spec)
  patterns:
    - "xcodegen info.properties for injecting LSUIElement and other plist keys into generated Info.plist"
    - "Local SPM package reference via path: ../swift/DesignRuler in project.yml"
    - "Ad-hoc code signing (CODE_SIGN_IDENTITY: '-') for Debug builds — no provisioning profile needed"
    - "ARCHS: $(ARCHS_STANDARD) produces universal binary (arm64 + x86_64)"

key-files:
  created:
    - App/project.yml
    - App/Sources/AppDelegate.swift
    - App/Sources/Info.plist
    - App/Design Ruler.xcodeproj/project.pbxproj
    - App/Design Ruler.xcodeproj/project.xcworkspace/contents.xcworkspacedata
  modified:
    - .gitignore (added Xcode xcuserdata and DerivedData exclusions)

key-decisions:
  - "xcodegen info.properties used instead of providing a pre-written Info.plist — xcodegen owns the plist and properties are injected, which correctly sets LSUIElement=true, NSHighResolutionCapable=true, NSPrincipalClass, NSApplicationSupportsSecureRestorableState"
  - "Code signing: CODE_SIGN_IDENTITY set to '-' for Debug (ad-hoc local signing, no Apple Developer account required for development builds)"
  - "No entitlements file — App Sandbox disabled (required for CGEventTap + CGWindowListCreateImage in Phase 19+)"

patterns-established:
  - "project.yml info: block: use path + properties to control Info.plist generation (not a standalone plist file)"
  - "xcodegen generate run from App/ directory"
  - "DerivedData excluded from git — build artifacts never committed"

# Metrics
duration: 2min
completed: 2026-02-18
---

# Phase 18 Plan 02: Build System Summary

**Xcode project for standalone macOS app with DesignRulerCore local SPM dependency: LSUIElement agent, universal binary, macOS 14 minimum, BUILD SUCCEEDED**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-18T13:23:47Z
- **Completed:** 2026-02-18T13:26:43Z
- **Tasks:** 1
- **Files modified:** 6

## Accomplishments
- Created xcodegen YAML spec (`App/project.yml`) referencing DesignRulerCore as a local SPM package dependency
- Created minimal `@main` AppDelegate stub (Phase 18 build system only — features come in Phase 19+)
- Generated Info.plist with LSUIElement=true (no Dock icon, no Cmd+Tab), NSHighResolutionCapable, universal binary
- Generated and committed `App/Design Ruler.xcodeproj` — engineers can open without installing xcodegen
- Verified `xcodebuild build` produces BUILD SUCCEEDED with DesignRulerCore compiled and linked (DesignRulerCore.o present in derived data)
- Updated .gitignore with xcuserdata and DerivedData exclusions

## Task Commits

Each task was committed atomically:

1. **Task 1: Create Xcode app project with xcodegen** - `2751461` (feat)

**Plan metadata:** (docs commit — see state updates)

## Files Created/Modified
- `App/project.yml` - xcodegen spec: macOS app target, DesignRulerCore dependency, bundle id, universal arch
- `App/Sources/AppDelegate.swift` - @main stub with applicationShouldTerminateAfterLastWindowClosed → false
- `App/Sources/Info.plist` - generated by xcodegen with LSUIElement=true, NSHighResolutionCapable, NSPrincipalClass
- `App/Design Ruler.xcodeproj/project.pbxproj` - generated Xcode project file
- `App/Design Ruler.xcodeproj/project.xcworkspace/contents.xcworkspacedata` - workspace metadata
- `.gitignore` - added Xcode xcuserdata and DerivedData exclusion patterns

## Decisions Made
- Used `info: path + properties` in project.yml rather than providing a standalone Info.plist — xcodegen owns and generates the plist; `properties` block injects LSUIElement and other custom keys. This prevents file conflicts when regenerating the project.
- Ad-hoc code signing (`CODE_SIGN_IDENTITY: "-"`) for Debug — no provisioning profile needed for local development builds.
- No entitlements file — App Sandbox must remain disabled for CGEventTap + CGWindowListCreateImage (locked decision from research phase).

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] xcodegen info.path overwrites pre-written Info.plist**
- **Found during:** Task 1, Step 6 (xcodegen generate)
- **Issue:** Plan specified writing a complete Info.plist first, then using `info: path: Sources/Info.plist` in project.yml. xcodegen's `info: path` causes it to generate and overwrite the plist from scratch — our pre-written LSUIElement was wiped.
- **Fix:** Removed standalone Info.plist approach. Updated project.yml to use `info: path + properties` block, letting xcodegen generate the base plist and injecting LSUIElement, NSHighResolutionCapable, NSPrincipalClass, NSApplicationSupportsSecureRestorableState via `properties`. Regenerated the project.
- **Files modified:** `App/project.yml` (added properties block), `App/Sources/Info.plist` (now xcodegen-owned)
- **Verification:** `grep "LSUIElement" App/Sources/Info.plist` confirms `<true/>` is present in generated plist
- **Committed in:** `2751461` (same Task 1 commit after fix)

---

**Total deviations:** 1 auto-fixed (Rule 1 - Bug)
**Impact on plan:** Essential correctness fix. Info.plist now contains all required keys including LSUIElement. Plan outcome unchanged — LSUIElement=true is confirmed in the generated plist.

## Issues Encountered
- xcodegen `info: path` generates the plist at the specified path rather than reading a pre-existing file. Using `properties` inside the `info` block is the correct approach for injecting custom plist keys while letting xcodegen manage the base content.

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Standalone macOS app shell is ready: builds cleanly, links DesignRulerCore, no Dock icon, universal binary
- Phase 19 (app target features) can now import DesignRulerCore APIs and add menu bar icon, global hotkey registration, and overlay window launching
- Raycast extension build (`ray build`) is unaffected — continues working exactly as before

---
*Phase: 18-build-system*
*Completed: 2026-02-18*

## Self-Check: PASSED

- FOUND: App/project.yml
- FOUND: App/Sources/AppDelegate.swift
- FOUND: App/Sources/Info.plist (with LSUIElement=true)
- FOUND: App/Design Ruler.xcodeproj/project.pbxproj
- FOUND: .planning/phases/18-build-system/18-02-SUMMARY.md
- FOUND commit 2751461 (feat(18-02): create Xcode app project with xcodegen)
